<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.app.mapper.BoardMapper">

    <sql id="search">
        <if test="search.keyword != null">
            <where>
            	<foreach item="type" collection="search.types" separator="OR">
<!--                <trim prefixOverrides="OR">  -->
<!--                    <foreach item="type" collection="search.types"> -->
<!--                        <trim prefix="OR"> -->
                            <choose>
                                <when test="type == 't'.toString()">
                                    BOARD_TITLE LIKE '%' || #{search.keyWord} || '%'
                                </when>
                                <when test="type == 'w'.toString()">
                                    BOARD_WRITER LIKE '%' || #{search.keyWord} || '%'
                                </when>
                                <when test="type == 'c'.toString()">
                                    BOARD_CONTENT LIKE '%' || #{search.keyWord} || '%'
                                </when>
                            </choose>
<!--                        </trim>  -->
<!--                    </foreach>   -->
<!--                </trim>          -->
				</foreach>
			</where>
        </if>
    </sql>
    
	<select id="getBoardList" resultType="BoardVo">        
		SELECT BOARD_NO, BOARD_TITLE, BOARD_WRITER, BOARD_CONTENT, BOARD_REG_DATE, BOARD_UPDATE_DATE
	        FROM
	        (
	            SELECT ROWNUM R, BOARD_NO, BOARD_TITLE, BOARD_WRITER, BOARD_CONTENT, BOARD_REG_DATE, BOARD_UPDATE_DATE
	            FROM
	            (
	                SELECT BOARD_NO, BOARD_TITLE, BOARD_WRITER, BOARD_CONTENT, BOARD_REG_DATE, BOARD_UPDATE_DATE
	                FROM TBL_BOARD
	                <include refid="search"/>
	                ORDER BY BOARD_NO DESC
	            ) B
	            <![CDATA[WHERE ROWNUM <= #{criteria.page} * #{criteria.rowCount}]]>
	        )
	    WHERE R > (#{criteria.page} - 1) * #{criteria.rowCount}
	    
<!--	<![CDATA[
		SELECT 
				BOARD_NO, 
				BOARD_TITLE, 
				BOARD_WRITER, 
				BOARD_CONTENT, 
				BOARD_REG_DATE, 
				BOARD_UPDATE_DATE
		FROM (
			
				SELECT 
						ROWNUM  R,
						BOARD_NO, 
						BOARD_TITLE, 
						BOARD_WRITER, 
						BOARD_CONTENT, 
						BOARD_REG_DATE, 
						BOARD_UPDATE_DATE
				FROM (
						SELECT 
							BOARD_NO, 
							BOARD_TITLE, 
							BOARD_WRITER, 
							BOARD_CONTENT, 
							BOARD_REG_DATE, 
							BOARD_UPDATE_DATE
						FROM TBL_BOARD
                		<include refid="search"/>
					    ORDER BY BOARD_NO DESC
				) B
				WHERE ROWNUM <= #{criteria.page} * #{criteria.rowCount}
		)
		WHERE R > (#{criteria.page} - 1) * #{criteria.rowCount}
	
	]]>   -->
	</select>
	
	<select id="getBoardReadBoardNo" resultType="BoardVO">
	<![CDATA[
		SELECT 
				BOARD_NO, 
				BOARD_TITLE, 
				BOARD_WRITER, 
				BOARD_CONTENT, 
				BOARD_REG_DATE, 
				BOARD_UPDATE_DATE
		FROM TBL_BOARD
		WHERE   BOARD_NO = #{boardNo}
	]]>
	</select>
	
	<select id="getTotal" resultType="int">
	<![CDATA[
		SELECT COUNT(*) AS total
		FROM TBL_BOARD
	]]>
		<include refid="search"/>
	</select>
	
	<insert id="postBoardWrite">
	<![CDATA[
		INSERT INTO TBL_BOARD
				(BOARD_NO, 
				 BOARD_TITLE, 
				 BOARD_WRITER, 
				 BOARD_CONTENT)
		VALUES
				(SEQ_TBL_BOARD.NEXTVAL,
				 #{boardTitle},
				 #{boardWriter},
				 #{boardContent})
	]]>
	</insert>
	
	<update id="postBoardModify">
	<![CDATA[
		UPDATE TBL_BOARD
			SET BOARD_TITLE       = #{boardTitle},  
				BOARD_CONTENT     = #{boardContent}, 
				BOARD_UPDATE_DATE = SYSDATE
		WHERE   BOARD_NO          = #{boardNo}
	]]>
	</update>
	
	<delete id="postBoardRemove">
	<![CDATA[
		DELETE FROM TBL_BOARD
		WHERE BOARD_NO = #{boardNo}
	]]>
	</delete>
	
</mapper>